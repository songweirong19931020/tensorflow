,remark,result
0,住院患者是否择期手术\r   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00045';\r \r  INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,\r                    remark,st_date) \r                    \r  select \r     'D00045',\r     1,\r     d.bah as patient_id,\r     d.zycs as visit_id,\r     a.pai_visit_id,\r     now(),\r     '是否择期手术',\r     to_char(d.cyrq ,'yyyymmdd') AS st_date\r   from his_bi.ods_patient_medical_record d \r   left join his_bi.pts_pai_visit a\r   on (a.patient_id =d.bah and a.visit_id =d.zycs)\r  where d.cyrq  is not null \r    and d.rytj <>'1' --入院方式非急诊入院\r    and exists (select 1 from his_bi.ods_patient_opertion_info opoi \r              where opoi.brxh =d.brxh and opoi.surgerytype in ('1','4')) --入院的手术患者（手术和介入治疗）\r    and d.cyrq  >= to_date(c_daylist.day_id,'yyyyMMdd')\r    and d.cyrq  <  to_date(c_daylist.day_id,'yyyyMMdd')+1;\r \r "
1,是否下转患者   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00046';   INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,                    remark,st_date)                       select      'D00046',     1,     d.bah as patient_id,     d.zycs as visit_id,     a.pai_visit_id,     now(),     '是否下转患者',     to_char(d.cyrq ,'yyyymmdd') AS st_date   from his_bi.ods_patient_medical_record d    left join his_bi.pts_pai_visit a   on (a.patient_id =d.bah and a.visit_id =d.zycs)  where d.cyrq  is not null     and d.lyfs='3'    and d.cyrq  >= to_date(c_daylist.day_id,'yyyyMMdd')    and d.cyrq  <  to_date(c_daylist.day_id,'yyyyMMdd')+1;  "
2,住院患者是否手术患者（国家标准）   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00048';   INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,                    remark,st_date)   select 'D00048',     1,      a.bah as patient_id,     a.zycs as visit_id,     pt.pai_visit_id,     now(),      '是否手术患者(0 否 1是)',     to_char(a.cyrq,'yyyymmdd') as st_date   from his_bi.ods_patient_medical_record a  inner join his_bi.pts_pai_visit pt on a.bah = pt.patient_id and a.zycs = pt.visit_id  where exists (select 1 from his_bi.ods_patient_opertion_info t         where t.brxh =a.brxh            and t.surgerytype in ('1','4')) --入院的手术患者（手术和介入治疗）   and a.cyrq >= to_date(c_daylist.day_id,'yyyyMMdd')   and a.cyrq <  to_date(c_daylist.day_id,'yyyyMMdd') + 1 ;    "
3,住院患者是否微创手术患者(0 否 1是)（国家标准）\r   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00049';\r \r  INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,\r                    remark,st_date) \r  select distinct 'D00049',\r     1,\r      a.bah as patient_id,\r     a.zycs as visit_id,\r     pt.pai_visit_id,\r     now(),\r     '是否微创手术患者(0 否 1是)',\r      to_char(a.cyrq,'yyyymmdd') as st_date\r    from his_bi.ods_patient_medical_record a\r   inner join his_bi.pts_pai_visit pt on a.bah = pt.patient_id and a.zycs = pt.visit_id\r  inner join his_bi.ods_patient_opertion_info t on t.brxh =a.brxh\r   where 1=1\r     and exists(select 1 from his_bi.dim_oper_mini_info mf\r         where t.surgerycode = mf.icd9_code)\r     and a.cyrq >= to_date(c_daylist.day_id,'yyyyMMdd')\r     and a.cyrq <  to_date(c_daylist.day_id,'yyyyMMdd') + 1 \r  ;\r\r "
4,住院患者是否四级手术患者(0 否 1是)（国家标准）   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00050';   INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,                    remark,st_date)   select distinct      'D00050',      1,     a.bah as patient_id,     a.zycs as visit_id,     pt.pai_visit_id,     now(),     '是否四级手术患者(0 否 1是)',     to_char(a.cyrq,'yyyymmdd') as st_date   from his_bi.ods_patient_medical_record a  inner join his_bi.pts_pai_visit pt on a.bah = pt.patient_id and a.zycs = pt.visit_id  inner join his_bi.ods_patient_opertion_info t on t.brxh =a.brxh   where 1=1   and exists(select 1 from his_bi.dim_3_4_oper_info m         where t.surgerycode = m.icd9_code)    and a.cyrq >= to_date(c_daylist.day_id,'yyyyMMdd')    and a.cyrq <  to_date(c_daylist.day_id,'yyyyMMdd') + 1  ; "
5,住院重疾患者当天重返（国家标准）\r   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00100';\r \r  INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,\r                    remark,st_date) \r  select distinct 'D00100',\r     1 , \r     patient_id,\r     visit_id,\r     pai_visit_id,\r     now(),\r     '重疾患者当天重返（国家标准）',\r     st_date\r from (\r           select t.pai_visit_id as pai_visit_id,a.bah as patient_id,a.zycs as visit_id,to_char(a.cyrq,'yyyymmdd') as st_date\r     from his_bi.ods_patient_medical_record  a\r     inner join his_bi.v_inp_return_patient t \r      on a.bah = t.patient_id \r      and a.zycs > t.visit_id \r      and to_date(to_char(a.ryrq,'yyyymmdd'),'yyyymmdd') = to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')                                   \r     where  not exists (select 1 from his_bi.ods_patient_diag_info where a.bah=bah\r               and diagdiseasecodestr in ('Z51.0','Z51.1','Z51.2','Z51.5','Z51.8'))    \r      and a.cyrq >= to_date(c_daylist.day_id,'yyyyMMdd')\r      and a.cyrq <  to_date(c_daylist.day_id,'yyyyMMdd') + 1 \r     group by t.pai_visit_id,a.bah,a.zycs,to_char(a.cyrq,'yyyymmdd')\r  ) s ; /*多次重返患者，出院当天只打一次重返标志*/\r \r "
6,住院重疾患者2-15天重返（国家标准）\r   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00101';\r \r  INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,\r                    remark,st_date) \r  select distinct 'D00101',\r     1 , \r     patient_id,\r     visit_id,\r     pai_visit_id,\r     now(),\r     '重疾患者2-15天重返（国家标准）',\r     st_date\r from (\r    select a.pai_visit_id,d.bah as patient_id,d.zycs as visit_id,to_char(d.cyrq,'yyyymmdd') as st_date\r     from his_bi.ods_patient_medical_record d \r     left join his_bi.pts_pai_visit a on (d.bah =a.patient_id and d.zycs =a.visit_id)\r     inner join his_bi.v_inp_return_patient t \r      on d.bah = t.patient_id \r      and d.zycs > t.visit_id\r      and to_date(to_char(d.ryrq ,'yyyymmdd'),'yyyymmdd') >\r        to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')\r      and to_date(to_char(d.ryrq,'yyyymmdd'),'yyyymmdd') - 15 <=\r        to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')  \r     where not exists (select 1 from his_bi.ods_patient_diag_info where d.brxh=brxh\r               and diagdiseasecodestr in ('Z51.0','Z51.1','Z51.2','Z51.5','Z51.8'))    \r      and d.cyrq >= to_date(c_daylist.day_id,'yyyyMMdd')\r     and d.cyrq <  to_date(c_daylist.day_id,'yyyyMMdd') + 1 \r  ) s ; /*多次重返患者，出院当天只打一次重返标志*/\r \r "
7,住院重疾患者16-31天重返（国家标准）\r   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00102';\r \r  INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,\r                    remark,st_date) \r  select distinct 'D00102',\r     1 , \r     patient_id,\r     visit_id,\r     pai_visit_id,\r     now(),\r     '重疾患者16-31天重返（国家标准）',\r     st_date\r from (\r    select a.pai_visit_id,d.bah as patient_id,d.zycs as visit_id,to_char(d.cyrq,'yyyymmdd') as st_date\r     from his_bi.ods_patient_medical_record d \r      left join his_bi.pts_pai_visit a\r      on (d.bah =a.patient_id and d.zycs=a.visit_id)\r     inner join his_bi.v_inp_return_patient t \r      on d.bah = t.patient_id \r      and d.zycs > t.visit_id \r      and to_date(to_char(d.ryrq,'yyyymmdd'),'yyyymmdd')-15 >\r        to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')\r      and to_date(to_char(d.ryrq,'yyyymmdd'),'yyyymmdd') - 31 <=\r        to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')                                    \r     where  not exists (select 1 from his_bi.ods_patient_diag_info where d.brxh=brxh\r               and diagdiseasecodestr in ('Z51.0','Z51.1','Z51.2','Z51.5','Z51.8'))    \r      and d.cyrq >= to_date(c_daylist.day_id,'yyyyMMdd')\r     and d.cyrq <  to_date(c_daylist.day_id,'yyyyMMdd') + 1 \r  ) s ; /*多次重返患者，出院当天只打一次重返标志*/\r \r "
8,住院重疾患者1-31天重返（国家标准）\r   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00103';\r \r  INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,\r                    remark,st_date) \r  select distinct 'D00103',\r     1 , \r     patient_id,\r     visit_id,\r     pai_visit_id,\r     now(),\r     '重疾患者1-31天重返（国家标准）',\r     st_date\r from (\r     select a.pai_visit_id,d.bah as patient_id,d.zycs as visit_id,to_char(d.cyrq ,'yyyymmdd') as st_date\r     from his_bi.ods_patient_medical_record d \r     left join his_bi.pts_pai_visit a\r     on (a.patient_id =d.bah and a.visit_id =d.zycs)\r     inner join his_bi.v_inp_return_patient t \r      on a.patient_id = t.patient_id \r      and a.visit_id > t.visit_id\r      and to_date(to_char(d.ryrq ,'yyyymmdd'),'yyyymmdd') >=\r        to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')\r      and to_date(to_char(d.ryrq,'yyyymmdd'),'yyyymmdd') - 31 <=\r        to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')                                     \r     where  not exists (select 1 from his_bi.ods_patient_diag_info where d.brxh =brxh\r               and diagdiseasecodestr in ('Z51.0','Z51.1','Z51.2','Z51.5','Z51.8'))    \r      and d.cyrq >= to_date(c_daylist.day_id,'yyyyMMdd')\r      and d.cyrq <  to_date(c_daylist.day_id,'yyyyMMdd') + 1 \r  ) s ; /*多次重返患者，出院当天只打一次重返标志*/\r \r "
9,16-31天重返（国家标准）\r   ,"delete from his_bi.dwd_inp_medical_d  where st_date = c_daylist.day_id and key = 'D00216';\r \r  INSERT into his_bi.dwd_inp_medical_d (key,value,patient_id,visit_id,pai_visit_id,insert_date,\r                    remark,st_date) \r  select distinct 'D00216',\r     1 , \r     patient_id,\r     visit_id,\r     pai_visit_id,\r     now(),\r     '重疾患者16-31天重返（国家标准）',\r     st_date\r from (\r    select a.pai_visit_id,d.bah as patient_id,d.zycs as visit_id,to_char(d.cyrq,'yyyymmdd') as st_date\r     from his_bi.ods_patient_medical_record d \r      left join his_bi.pts_pai_visit a on (d.bah =a.patient_id and d.zycs =a.visit_id)\r     inner join his_bi.v_inp_return_patient t \r      on d.bah = t.patient_id \r      and d.zycs > t.visit_id \r      and to_date(to_char(d.ryrq,'yyyymmdd'),'yyyymmdd')-15 >\r        to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')\r      and to_date(to_char(d.ryrq,'yyyymmdd'),'yyyymmdd') - 31 <=\r        to_date(to_char(t.discharge_dept_date,'yyyymmdd'),'yyyymmdd')                                    \r     where not exists (select 1 from his_bi.ods_patient_diag_info where d.brxh=brxh\r               and diagdiseasecodestr in ('Z51.0','Z51.1','Z51.2','Z51.5','Z51.8'))    \r      and d.cyrq >= to_date(c_daylist.day_id,'yyyyMMdd')\r     and d.cyrq <  to_date(c_daylist.day_id,'yyyyMMdd') + 1 \r  ) s ; /*多次重返患者，出院当天只打一次重返标志*/\r \r "
